

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      PrettyDebugJS.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      API Documentation
    </h3>

    
      <h3>
        Links
      </h3>
      
        <a href="/Examples_example.js.html">Generic Example</a>
      
    

    

    
      <h3>
        Resources
      </h3>
      
        <a href="https://github.com/shadlyd15/PrettyDebugJS">Github</a>
      
    

    <h3>Modules</h3><ul><li id="pretty-debug-nav"><a href="module-pretty-debug.html">pretty-debug</a><ul class='methods'><li data-type="method" id="pretty-debug-setOptions-nav"><a href="module-pretty-debug.html#.setOptions">setOptions</a></li><li data-type="method" id="pretty-debug-generatePolicy-nav"><a href="module-pretty-debug.html#.generatePolicy">generatePolicy</a></li><li data-type="method" id="pretty-debug-attachStream-nav"><a href="module-pretty-debug.html#.attachStream">attachStream</a></li><li data-type="method" id="pretty-debug-detachStream-nav"><a href="module-pretty-debug.html#.detachStream">detachStream</a></li><li data-type="method" id="pretty-debug-log-nav"><a href="module-pretty-debug.html#.log">log</a></li><li data-type="method" id="pretty-debug-info-nav"><a href="module-pretty-debug.html#.info">info</a></li><li data-type="method" id="pretty-debug-alert-nav"><a href="module-pretty-debug.html#.alert">alert</a></li><li data-type="method" id="pretty-debug-warn-nav"><a href="module-pretty-debug.html#.warn">warn</a></li><li data-type="method" id="pretty-debug-error-nav"><a href="module-pretty-debug.html#.error">error</a></li><li data-type="method" id="pretty-debug-critical-nav"><a href="module-pretty-debug.html#.critical">critical</a></li><li data-type="method" id="pretty-debug-nodeMemoryMonitor-nav"><a href="module-pretty-debug.html#.nodeMemoryMonitor">nodeMemoryMonitor</a></li><li data-type="method" id="pretty-debug-sysMemoryMonitor-nav"><a href="module-pretty-debug.html#.sysMemoryMonitor">sysMemoryMonitor</a></li><li data-type="method" id="pretty-debug-memoryWatermark-nav"><a href="module-pretty-debug.html#.memoryWatermark">memoryWatermark</a></li><li data-type="method" id="pretty-debug-scheduleHealthCheck-nav"><a href="module-pretty-debug.html#.scheduleHealthCheck">scheduleHealthCheck</a></li></ul></li><li id="Default Options-nav"><a href="module-Default%2520Options.html">Default Options</a></li><li id="ANSI Color Codes-nav"><a href="module-ANSI%2520Color%2520Codes.html">ANSI Color Codes</a></li></ul><h3 id="global-nav"><a href="global.html">Global</a></h3>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        PrettyDebugJS.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>/**
 * @fileOverview Pretty Debug Javascript
 * @author Shadly Salahuddin
 * @link mailto:shadlyd15@gmail.com
 * @version 2.0.1
 */

const fs	=	require('fs');
const util	=	require('util');
const options = require('./defaultOptions');
const ansiColors = require('./ansiColors');

function _updateOptions(obj, options = {}) {
    for (var key in options) {
        if (typeof options[key] === "object") {
            _updateOptions(obj[key], options[key]);   
        } else {
            obj[key] = options[key];
        }
    }
}

function _checkUniqueStream(targetArray, targetValue){ 
    for(let i = 0; i &lt; targetArray.length; i++){
    	if(targetArray[i] === targetValue) return false;    	
    }
    return true;
}

function _paintText(text, color, resetColor = ''){
	return color + text + resetColor;
}

function _renderTextSegment(text, color, resetColor = ''){
	if(text === undefined) return '';
	return _paintText('[' + text + ']', options.enableColor?color:'', options.enableColor?resetColor:'');
}

function _getCurrentDateTime(){
	if(options['dateTime']['show'] !== true) return undefined;
	return new Date().toLocaleTimeString('en-US', options['dateTime']['format']);
}

function _renderMessage(tag, functionName, fileLocation, message, color){
	return	_renderTextSegment(_getCurrentDateTime(), options['dateTime']['color'], ' ')
			+ _renderTextSegment(functionName, options['funcName']['color'], ' ')
			+ _renderTextSegment(fileLocation, options['fileLocation']['color'], ' ')
			+ _renderTextSegment(tag, color, ' : ')
			+ _renderTextSegment(message, color, ansiColors.reset);
}

function _getFunctionCallLocation(){
	var err = new Error();
	Error.captureStackTrace(err);
	let fileLocation;
	let functionName;

	if(options.fileLocation.show === true){
		const regexFile = /\((.*)\)$/;
		const matchFile = regexFile.exec(err.stack.split(/\r\n|\n/, 4)[3]);
		if((matchFile != null) &amp;&amp; (matchFile.length > 1)){
			fileLocation = matchFile[1].replace(/^.*[\\\/]/, '');
		}
	}
	if(options.funcName.show === true &amp;&amp; fileLocation){
		functionName = err.stack
						.split('\n', 4)[3]
						.replace(/^\s+at\s+(.+?)\s.+/g, '$1' );
    } else{
    	functionName = 'Callback';
    }
	return {
		functionName : functionName,
		fileLocation : fileLocation
	}
}

function _bytesToMb(kilo){
	return Math.round(kilo / 1024 / 1024 * 100) / 100;
}

function _setWaterMark(watermark, currentValue){
	watermark.now = currentValue;
	if(watermark.peak &lt;= currentValue){
		watermark.peak = currentValue;
		watermark.time 	= new Date().toLocaleTimeString('en-US', options['memoryWatermark']['dateTime']['format']);
	}
}

function _checkAlarmPolicy(policy, currentValue){
	for (var key in policy) {
		if (policy[key]['lowerLimit'] > currentValue[key]){ 
			return true;
		}
		if (policy[key]['upperLimit'] &lt; currentValue[key]){
			return true;
		}
	}
}

function _generateFunction(tag){
	return function(){
		if((options.enable != true) || options[tag]['level'] > options['debugLevel']) return;
		const currentLocationInfo = _getFunctionCallLocation();
		_printToAllStreams(_renderMessage(	options[tag]['tag'],
											currentLocationInfo['functionName'], 
											currentLocationInfo['fileLocation'], 
											util.format.apply(this, arguments),
											options[tag].color)
		);
	};
}

function _generateTextFromObj(obj, callback){
	let text = '';
	for(let key in obj){
		if(obj[key]){
			text = text + callback(key) ;
		}
	}
	return text;
}

const debugStreams = [process.stdout];

function _printStream(stream, message){
	if(stream){
		stream.write(message + '\n');
	}
};

function _printToAllStreams(message){
	debugStreams.forEach(function(stream){
		_printStream(stream, message);
	});
};


/**
 * @module pretty-debug
 * @desc A highly configurable &amp; lightweight debug library that prints debug messages beautifully. 
 * It works in Node.js and Web browser environments with very low memory footprint. 
 */

module.exports = {
  /** Different ANSI color to decorate different segments
	* @type {Object.&lt;string>}
	* @property {string} reset		- Text Color Reset
    * @property {string} black 		- Text Color Block
    * @property {string} red 		- Text Color Red
    * @property {string} green 		- Text Color Green
    * @property {string} yellow 	- Text Color Yellow
    * @property {string} blue 		- Text Color Blue
    * @property {string} magenta 	- Text Color Magenta
    * @property {string} cyan 		- Text Color Cyan
    * @property {string} white 		- Text Color Cyan
	* @property {string} bgBlack 	- Background Color Black
	* @property {string} bgRed 		- Background Color Red
	* @property {string} bgGreen 	- Background Color Green
	* @property {string} bgYellow 	- Background Color Yellow
	* @property {string} bgBlue 	- Background Color Blue
	* @property {string} bgMagenta 	- Background Color Magenta
	* @property {string} bgCyan 	- Background Color Cyan
	* @property {string} bgWhite 	- Background Color White
	*/
	color : ansiColors,

  /**
	* Overwrites default options and debug text formats
	* @param {Object.&lt;userOptions>} userOptions - Options User specific options
	*/
	setOptions: function setOptions(userOptions){
		_updateOptions(options, userOptions);
	},

  /**
	* Generates policy for different memory monitors
	* @param {number} lowerLimit - Lower limit
	* @param {number} upperLimit - Upper limit
	* @return {Object.&lt;policy>}
	*/
	generatePolicy: function generatePolicy(lower = 0, upper = 100){
		return {
			lowerLimit : `${lower}`,
			upperLimit : `${upper}`
		};
	},

  /**
	* Attaches stream to pipe debug output
	* @param {Object.&lt;stream>} stream - Stream to attach
	*/
	attachStream: function attachStream(stream){
		if(stream &amp;&amp; _checkUniqueStream(debugStreams, stream)){
			debugStreams.push(stream);
			this.alert('New Debug Stream Attached');
		}
	},

  /**
	* Detaches stream from debug output
	* @param {Object.&lt;stream>} stream - Stream to detach
	*/
	detachStream: function detachStream(stream){
		let filteredStreams = debugStreams.filter(function(value){
		    return ( value != stream );
		});
		debugStreams = filteredStreams;
		this.info('Debug Stream Detached');
	},

  /**
	* Prints log messages in level 6
	* @function
	* @param {...*} var_args Variadic Argument
	* @example
	* debug.log("Just a simple log message");
	* @example
	* const policy = { upperLimit : 70, lowerLimit : 20 };
	* debug.log(policy);
	*/
	log			: _generateFunction('log'),

  /**
	* Prints info messages in level 5
	* @function
	* @param {...*} var_args Variadic Argument
	* @example
	* debug.info("Here is an info message.");
	* @example
	* const birthTimestamp = { date : "15/12/1993", time : "12:05 AM" };
	* debug.info(birthTimestamp);
	*/
	info		: _generateFunction('info'),

  /**
	* Prints alert messages in level 4
	* @function
	* @param {...*} var_args Variadic Argument
	* @example
	* debug.alert("An alert message!");
	* @example
	* const birthTimestamp = { date : "15/12/1993", time : "12:05 AM" };
	* debug.alert(birthTimestamp);
	*/
	alert		: _generateFunction('alert'),
  
  /**
	* Prints warn messages in level 3
	* @function
	* @param {...*} var_args Variadic Argument
	* @example
	* debug.warn("This is your last warning.");
	* @example
	* const resource = { RAM : 10, CPU : 60 };
	* debug.warn(resource);
	*/
	warn		: _generateFunction('warn'),

  /**
	* Prints error messages in level 2
	* @function
	* @param {...*} var_args Variadic Argument
	* @example
	* debug.error("Error in recording server");
	* @example
	* const errorMessage = { message : "Some Error", errorCode : 4 };
	* debug.error(errorMessage);
	*/
	error		: _generateFunction('error'),

  /**
	* Prints critical messages in level 1
	* @function
	* @param {...*} var_args Variadic Argument
	* @example
	* debug.critical("API server critical error");
	* @example
	* const criticalMessage = { message : "Some Critical Error" };
	* debug.critical(criticalMessage);
	*/
	critical	: _generateFunction('critical'),

  /**
	* Prints RAM usage by Node.js
	* @param {Object.&lt;stream>} stream - Stream Object
	* @param {function} callback - Callback function to invoke when alarm triggers
	* @example
	* debug.nodeMemoryMonitor({
	*		heapTotal: { upperLimit : 100 }
	* 	}, function(){
	*		debug.critical('Memory Usage Alarm : Total heap usage is above 100 MB');
	*	}
	* );
	*/
	nodeMemoryMonitor: function nodeMemoryMonitor(alarmPolicy = {}, callback = null){
		if(options.enable != true) return;
		const nodeMemInfo = process.memoryUsage();

		let message = _renderMessage(	'MEMORY',
										'Node', 
										undefined, 
										_generateTextFromObj(options.nodeMemoryMonitor.fields, function(key){
											return `| ${key} : ${_bytesToMb(nodeMemInfo[key])} MB |`;
										}),
										options['nodeMemoryMonitor']['color']);

		_setWaterMark(options.memoryWatermark.fields['Node'], _bytesToMb(nodeMemInfo.heapUsed));
		_printToAllStreams(message);

		if(_checkAlarmPolicy(alarmPolicy, nodeMemInfo) &amp;&amp; callback) callback();
	},

  /**
	* Prints RAM usage by operating system
	* @param {Object.&lt;alarmPolicy>} alarmPolicy - Policy object to trigger alarm
	* @param {function} callback - Callback function to invoke when alarm triggers	
	* @example
	* debug.sysMemoryMonitor({
	*		MemTotal: { upperLimit : 700 }
	* 	}, function(){
	*		debug.critical('Memory Usage Alarm : Total system memory usage is above 700 MB');
	*	}
	* );
	*/
	sysMemoryMonitor: function sysMemoryMonitor(alarmPolicy = {}, callback = null){
		if(options.enable != true) return;
		fs.readFile('/proc/meminfo', function (err, data){
			if (err) throw err;
			var info = {};
			data.toString().split(/\n/g).forEach(function(line){
			   line = line.split(':');
			   if (line.length &lt; 2){
			       return;
			   }	
			   info[line[0]] = Math.round(parseInt(line[1].trim(), 10) / 1024);
			});

			let message = _renderMessage(	'MEMORY',
											'System', 
											undefined,
											_generateTextFromObj(options.sysMemoryMonitor.fields, function(key){
												return `| ${key} : ${info[key]} MB |`;
											}),
											options['sysMemoryMonitor'].color);

			_setWaterMark(options.memoryWatermark.fields['Swap'], info['SwapTotal'] - info['SwapFree']);
			_setWaterMark(options.memoryWatermark.fields['RAM'], info['MemTotal'] - info['MemAvailable']);

			_printToAllStreams(message);

			if(_checkAlarmPolicy(alarmPolicy, info) &amp;&amp; callback) callback();
		});
	},

  /**
	* Prints highest RAM usage in application. Scheduled healthcheck is needed to set watermark.
	* @example memoryWatermark();
	*/
	memoryWatermark: function memoryWatermark(){
		if(options.enable != true) return;
		let message = _renderMessage(	'Watermark',
										undefined, 
										undefined,
										_generateTextFromObj(options.memoryWatermark.fields, function(key){
											return `| ${key} : ${options.memoryWatermark.fields[key].peak} MB @ ${options.memoryWatermark.fields[key].time} |`;
										}),
										options['memoryWatermark'].color);

		_printToAllStreams(message);
	},

  /**
	* Set Schedule to perform healthcheck
	* @param {function} inputFunc - Healthcheck function
	* @param {numbers} timeInMinutes - Interval in minutes
	* @example
	* debug.scheduleHealthCheck(function(){
	* 	debug.memoryWatermark();
	* 	debug.sysMemoryMonitor();
	* 	debug.nodeMemoryMonitor({
	* 		heapTotal: { upperLimit : 5 }
	* 	}, function(){
	* 		debug.critical('Memory Usage Alarm : Total heap usage is above 5 MB');
	* 	});
	* }, 10);
	*/
	scheduleHealthCheck: function scheduleHealthCheck(inputFunc, timeInMinutes){
		if(options.enable != true) return;
		setTimeout(function(){
			if(options['enableGC'] &amp;&amp; global.gc){
				global.gc();
			}
			if(inputFunc){
				inputFunc();
				scheduleHealthCheck(inputFunc, timeInMinutes);
			}
		}, timeInMinutes * 60 * 1000);
	}
};



</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.0-dev</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
